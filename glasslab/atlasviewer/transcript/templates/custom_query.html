{% extends "admin/base_site.html" %}
{% load adminmedia %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% admin_media_prefix %}css/changelists.css" />
  <link rel="stylesheet" type="text/css" href="{% admin_media_prefix %}css/forms.css" />
{% endblock %}

{% block bodyclass %}change-list{% endblock %}

{% block title_part_1 %}Custom Query{% endblock %}

{% block content %}
<h1>Custom Query</h1>
{% if not stored_query %}
	<div style="border: 1px solid red; padding: 5px; width:80%;">
		<h2 style="margin-top:0px;">WARNING:</h2>
		<p>These queries are sent to the database raw and unmodified.<br />
		Please query with caution, and only if you know what you are doing.</p>
	</div>
	<br />
	Query:<br />
	<form action="/transcript/custom_query" method="get">
		<textarea id="id_query" name="query" style="width:80%; height: 200px;">{{ query }}</textarea>
		<br />
		<input type="submit" value="Submit" />
	</form>
{% else %}
<h2>{{ query.name }}</h2>
<a href="/transcript/custom_query_redirect/{{ query.id }}/" target="_blank">Rerun query</a>
<br />
<p>{{ query.notes|safe }}</p>
{% endif %}

{% if field_names %}
<br />
<div style="float:right;">
{% if not stored_query %}
<a href="/transcript/custom_query_export/?query={{ query|urlencode }}" target="_blank">Export to TSV</a>
{% else %}
<a href="/transcript/stored_results_export/{{ query.id }}/" target="_blank">Export to TSV</a>
{% endif %}
</div>
<h2>{% ifequal rows|length limit %}Limited to {% endifequal %}{{ rows|length }} Results:</h2>
	<table>
		<thead>
			<th>&nbsp;</th>
			{% for field in field_names %}
				<th>{{ field.0 }}</th>
			{% endfor %}
		</thead>
		{% for row in rows %}
		<tr class="{% cycle 'row1' 'row2' %}">
			<td>{{ forloop.counter }}
			{% for cell in row %}
				<td>{{ cell|safe }}</td>
			{% endfor %}
		</tr>
		{% endfor %}
	</table>

{% endif %}

{% endblock %}