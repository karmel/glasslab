'''
Created on Oct 1, 2010

@author: karmel
'''
from __future__ import division
import numpy
from glasslab.utils.geneannotation.gene_ontology import GOAccessor
from glasslab.utils.datatypes.genome_reference import GeneDetail,\
    TranscriptionStartSite, Genome
from glasslab.sequencing.datatypes.peak import CurrentPeak
from glasslab.utils.datatypes.gene_ontology_reference import BackgroundGOCount
from django.db.models.aggregates import Sum
from scipy.stats import binom_test
import os
from matplotlib import pyplot
from operator import itemgetter
from random import randint
from glasslab.utils.parsing.delimited import DelimitedFileParser

class EnrichedOntologiesAnalyzer(object):
    max_p_val = .05
    
    go_accessor = None
    foreground_ontologies = None
    background_term_count = None
    foreground_term_count = None

    enriched_terms = None
    def set_foreground_ontology(self, genes_names):
        '''
        For the passed set of genes of interest,
        get ontological terms from the GeneOntology database.
        '''
        if not self.go_accessor: self.go_accessor = GOAccessor()
        
        self.foreground_ontologies = self.go_accessor.get_ancestors_for_genes(genes_names)
        results_array = numpy.array(self.foreground_ontologies.values())
        #results_array = DelimitedFileParser('/Users/karmel/Desktop/Projects/GlassLab/SourceData/ThioMac_Lazar/analysis/MRL24-GO/less_pparg.tsv').get_array()
        #self.foreground_ontologies = dict(zip(results_array[:,0],results_array))
        self.foreground_term_count = sum(numpy.float_(results_array[:,-1]))
        
    def set_enriched_genes(self, genome_type, gene_names=None):
        '''
        Compare appearance counts and distributions of passed gene names 
        to the background counts for all genes of this genome type.
        '''
        if not gene_names:
            gene_names = self.get_gene_names_from_current_peaks()
            
        self.set_foreground_ontology(gene_names)
        if not self.background_term_count:
            self.background_term_count = BackgroundGOCount.objects.filter(genome_type=genome_type
                                                    ).aggregate(Sum('appearance_count'))['appearance_count__sum']
        
        enriched = {}
        for go_id, fg_info in self.foreground_ontologies.items():
            try: 
                go_term = BackgroundGOCount.objects.get(genome_type=genome_type, go_term_id=str(go_id))
                bg_info = [go_term.go_term_id, go_term.go_term, 
                           go_term.distance_from_root, go_term.appearance_count]
            except BackgroundGOCount.DoesNotExist:
                # Term didn't make the cut for the background. 
                # Assume the appearance in the foreground is the only occurrence in the background 
                bg_info = fg_info
            bg_appearance = bg_info[-1:][0]/self.background_term_count
            p_val = binom_test(fg_info[-1:][0], n=self.foreground_term_count, p=bg_appearance)
            if p_val <= self.max_p_val:
                enriched[go_id] = fg_info + [p_val]
        self.enriched_terms = enriched
        
    def output_go_enriched_ontology(self, output_dir, file_name, genome, gene_names=None):
        '''
        Retrieve GO enrihed terms as compared to background and output tsv file.
        '''
        if not self.enriched_terms:
            # Get list of (term id, term, distance from root, count, p val) tuples
            genome_type = Genome.objects.get(genome=genome).genome_type
            self.set_enriched_genes(genome_type, gene_names=gene_names)
        
        # Sort according to p-val
        enriched_terms = sorted(self.enriched_terms.values(),key=itemgetter(4))
        
        # Output tsv
        header = 'GO Term ID\tGO Term\tDistance from root\tAppearance Count\tP-value\n'
        output_tsv = header + '\n'.join(['\t'.join(map(lambda x: str(x).strip(), row)) for row in enriched_terms])
        file_path = os.path.join(output_dir,'%s_GO_enriched_terms.tsv' % file_name)
        file = open(file_path, 'w')
        file.write(output_tsv)
    
    def graph_terms(self, output_dir, file_name, genome, gene_names=None):
        if not self.enriched_terms:
            # Get list of (term id, term, distance from root, count, p val) tuples
            genome_type = Genome.objects.get(genome=genome).genome_type
            self.set_enriched_genes(genome_type, gene_names=gene_names)
        
        # Sort according to p-val
        enriched_terms = sorted(self.enriched_terms.values(),key=itemgetter(4))
        enriched_array = numpy.array(enriched_terms)
        
        fig = pyplot.figure(figsize=(16,10))
        ax1 = fig.add_subplot(111)
        pyplot.ylabel('Distance from the root of the GO Term Tree')
        pyplot.xlabel('Log P-Value')
        ax1.set_xscale('log')
        
        # Add some noise to the distance from root column so that
        # the points on the graph are sufficiently spaced out.
        for i,row in enumerate(enriched_array):
            row[2] = float(row[2]) + randint(-99,99)/100.0 
            # And annotate with terms
            ax1.text(float(row[4]), float(row[2]), row[1], fontsize=8, withdash=True)
            
        # Plot all points
        ax1.plot(numpy.float_(enriched_array[:,4]), numpy.float_(enriched_array[:,2]), 'o')
        
        pyplot.savefig(os.path.join(output_dir,'%s_GO_enriched_terms_graph' % file_name))
        
    def get_gene_names_from_current_peaks(self):
        '''
        Pull gene names/symbols from set of Current Peaks.
        '''
        where = ['"%s".sequence_identifier_id = "%s".id' \
                            % (GeneDetail._meta.db_table, TranscriptionStartSite._meta.db_table),
                 '"%s".transcription_start_site_id = "%s".id' \
                            % (CurrentPeak._meta.db_table, TranscriptionStartSite._meta.db_table),]
        tables = [CurrentPeak._meta.db_table, TranscriptionStartSite._meta.db_table]
        gene_names = GeneDetail.objects.extra(where=where, tables=tables
                                    ).values_list('gene_name', flat=True).distinct()
        return map(lambda x: x.strip(), list(gene_names))
        
if __name__ == '__main__':
    gene_names = ['Trpv1','Lca5l','Dab2ip','Prss48','Nckap5l','Utp14b','A430105I19Rik','Hspa2','Smg6','Rab44','Ccin','Krt74','Pcdha','Adamts7','Zc4h2','Ddx11','ORF61','Rab3ip','Dnmt3b','Kcnk7','A4galt','AU018091','Plekhg5','Slc28a1','2610020H08Rik','Zfp560','Cntnap2','Gprasp1','Asap2','Tacc2','Hps5','Sp9','Iqsec2','Phactr1','Mtus1','Dusp13','Slc7a6os','Slc25a42','Daam2','Gm5595','Mxi1','Nrsn2','Pde1a','Kctd14','Gjb6','Rnase13','Olfr212','Xkr4','Trex1','Ecm2','AU022252','Ankrd6','Adcy5','Lrrn4cl','Cbx6-Nptxr','Utp18','Podnl1','Rasl10b','Rreb1','Gm11487','Ric8b','Pard3','Pcdh17','Slc25a34','Gm13154','Abi3bp','Zmynd12','Fam189b','Vprbp','Btbd11','Gm414','Anks6','Adamts15','Tsku','Cdkl5','Mctp2','Triobp','Gm14403','Gm128','Rfx4','Trp53i13','Mbp','Adcyap1r1','Orc2l','Sema3g','Prrx1','BC026782','Gm527','Dnajc19','Magi1','Atad5','Pdzd4','Fat2','Mett11d1','Rdh8','Kcnk15','Olfm4','Pmp2','Dkc1','Smg1','Pear1','Sybu','Rasl12','Slc22a23','Fam83e','1700039E15Rik','Ncbp1','AU017455','Prickle1','Lin7a','Calr4','Pak6','Gls2','A630055G03Rik','Plk1s1','Gm129','Cox18','Zbtb16','Arhgef9','Sec31b','Gm628','Gm815','Zfp408','Gm1673','Gm1060','A830080D01Rik','AW146154','Pgap3','Slc47a2','Zdhhc6','Ube2u','Gm5820','Zfp551','Rps27a','Fam92b','C330019L16Rik','Pnpla1','2210404J11Rik','Gm5627','Zfp345','Sorbs1','Cacnb4','Ccne2','Wnk1','Nfatc2','Samd4','Rusc2','Arhgef10','Fam40b','Cml3','C130026I21Rik','Lipt1','Wdr93','Gm14092','Gm6878','Depdc6','Ctsa','Arsi','2210009G21Rik','Slc7a15','Ids','Rnf38','A330050B17Rik','Trpm1','Asb1','Vmn1r90','Npr3','Gmfg','Aifm2','C230096C10Rik','Tsc2','Polr2k','Pkig','Slco6b1','Lif','Myo6','Rad54b','4922505G16Rik','Gbp11','Strn4','Arap1','Tmem141','Pdzd9','Larp1b','Tacc3','Shroom4','Dear1','Peg10','Cdkn2a','BC051019','Akap1','Ryk','Cp','Dhx15','Oip5','Rarg','Neo1','Proc','Sema3b','Eml1','Rad17','Ubtf','Zfp2','Gcdh','Hsd11b1','Net1','Pard6a','Bdnf','Ghr','Zgpat','Usp33','Plin5','Git2','Fhl1','Cntnap5a','Scn8a','Shroom3','Pigw','Prmt2','4930578N16Rik','Dysf','Tcf7l1','Gpc6','Hoxb3','Brdt','Rnps1','Mark2','G3bp2','Cdr2l','Gm6484','Tead4','1500012F01Rik','Adamts6','Nav3','Btbd16','Dock9','Pdzd2','A1bg','Cep152','Morn1','Lmtk2','Ipo8','Clip3','Fam89a','Gli2','Adamts14','Dhtkd1','Awat1','Kcnq4','Gnat3','Prickle2','Oxtr','Npat','4921513D23Rik','Fam171a1','Phf21b','Eml5','Hcn4','Mamdc4','Dgki','Ermp1','Zfp174','Tln2','Polr3a','Prss53','Fat1','Dsel','Anubl1','Mphosph9','Xirp1','Gpr133','Rtkn2','Slc43a1','Nol8','Ttc37','2210408I21Rik','Prss36','Ctcfl','Armc4','Amotl1','Sclt1','Bod1l','Ttll5','Dip2c','Ccdc15','Fbln2','Wdr86','Furin','Gm10035','Zxdb','Acbd4','Tbc1d8b','Ccnd3','Xlr3b','Nacad','1700042B14Rik','Tomt','Rnf144a','Mcart6','Snrpn','Pdgfra','1600012H06Rik','Pars2','Nr3c2','Gpx3','Slc35a2','Car1','Speg','Tcp11','Ogfod1','Bhlhb9','Tead3','Tmem176a','4930505A04Rik','Kng2','Prrt2','Steap2','Ablim1','Vmn2r13','AW209491','Kif21a','Phf21a','Capn3','Rnft2','D0H4S114','Col18a1','Eftud2','Apoc1','Trim9','Akt2','Celf2','Ttk','Abhd14a','Peci','Gprc5c','BC060267','Gm11277','Rbm9','Cacna2d1','Crem','Runx1t1','Serpinh1','Dclk1','Cd34','Cd59a','Cdc25b','Stau2','Eif2b3','Caprin1','Aldh3a1','Bub1','Nfib','Chn1','Gnao1','Lifr','Zfp385b','Fggy','Epb4.1l5','Vmn2r29','Plin1','9-Sep','Csf1','Nudcd1','Sox5','Glo1','Tcf20','A630033H20Rik','Galnt9','Igf2','Wrn','Tiam2','Il1r1','Trp73','Trp63','Aldh7a1','Wisp3','Rbm47','Tspan32','Sgce','Hras1','Nfe2l1','Tcn2','Tpst1','D630003M21Rik','Apobec1','Lpgat1','AU019823','Ly6h','Ikbkg','Meis2','Enpp2','Pitpnm1','Sgca','Slc4a4','Ctnnbip1','Tmem80','Fbrsl1','Kbtbd12','Kctd1','Tcf7l2','BC024139','Lrrc27','Fam13c','Ralgds','Gse1','E130112L23Rik','5730528L13Rik','Ttc39a','Lpp','Atg4c','Rwdd2a','Txndc2','Rnf44','Lrrc49','Lrrc1','Fbxo34','Rangap1','Mrps10','Smoc1','Dpy30','Cln3','Smtn','Morc2a','Il1rap','Hgs','Dip2b','Per1','Gjc1','Upp1','Rab34','Pacsin2','Pax3','Wdr35','Cacna1c','Fgd2','Frk','Orc3l','Ephb4','Lrrc57','Nadk','Araf','Dut','Lax1','2-Sep','Pvrl2','Rab23','Nr5a2','Ccdc85c','Cenpl','Foxg1','Tor1aip2','Plekha6','Optc','F8','Grhl1','Ttc15','Vldlr','Acox2','Ilk','Lmo4','St3gal3','Rgs17','Pfkfb2','Efna1','Dtnb','Heatr7a','Mpst','Rnase10','1700030F18Rik','Pcx','Hif3a','Ccdc138','Phax','Eme2','Cog5','Lix1l','Fgfr3','Gdf1','Cabc1','Nlgn1','1700040I03Rik','Rpap2','Neurl1a','Fkbp10','Hsd17b13','Tmem175','Dnajc5b','Exosc8','Tjp1','Rab6','Nosip','1190007F08Rik','Rrp1b','Tcf19','Orc6l','Smad5','Mb','Pld1','Tgif1','Bcap29','Add3','Psmd10','Mtm1','Tmem176b','Nrf1','Fgfrl1','Cpsf7','Efemp2','Bcas1','Ctnna3','Cpsf4l','Amigo2','Vill','Tsr2','Nsmce2','Smpd4','Mum1l1','Apol7a','Trappc9','Hspb2','Sh3pxd2a','Adamts20','Dcaf4','Ctnnb1','Cldn14','Armcx1','F13a1','4931428F04Rik','Rab3a','D10Ertd610e','Pls3','Rasgrp3','Tead1','D2Wsu81e','Zfp280c','Klhl33','Ccdc85a','1110057K04Rik','9130404D08Rik','Atp2b4','Trmt2b','Clec2g','Jazf1','Wwtr1','Sugp2','Scara5','Tinagl1','Nfatc4','Ffar2','Kcns3','Tceal8','Gnl3l','Socs2','B3gnt2','Arpc4','Krit1','BC005764','Kirrel','Ahcyl2','Yap1','Gm11818','1700001C19Rik','Cuedc1','Rnh1','Rbms3','Exog','Aimp2','Sphk1','Mtap1a','Tfpi','Gm14431','Gm13698','Gm13696','Gm13694','Gm13697','Gm13691','Zfp516','H2-t9','Gng12','Gm10471','Adam23','Ak4','Ube2i','Grb10','Cyp26b1','Tsc22d1','Fbxw7','Sertad4','Afap1l2','Gps1','Elavl2','Rpgr','Txnrd3','Wdr53','Chchd7','Magt1','Ddc','Dcn','Dmpk','Dlk1','Kat2b','Pdlim5','Lins2','Lsm6','Sstr5','Lims1','Mical2','Cldn18','Dlc1','Chrna1','Adam12','Adcy6','Adra2a','Adrb1','Angpt2','Abcd1','Ap1b1','Aqp1','Aqp7','Bgn','Bsn','Btc','Cacna1a','Ddr1','Car3','Cav1','Cbr2','Cct5','Cd1d2','Cdh2','Cdkn2b','Cdr2','Cdx2','Cenpc1','Vsx2','Cidea','Elovl3','Clcn3','Col12a1','Col17a1','Col5a2','Col1a1','Col1a2','Cox8b','Cttn','Cyb561','Cyp2f2','Cyp7b1','Dctn1','Dffb','Dlx4','Dsg2','Dub1','E2f5','Ebf1','Efna4','Elk1','Emp2','Ephx2','Ereg','Mecom','Evx1','Fscn1','Fasn','Fdx1','Fgd1','Fgf10','Fgf2','Akr1b8','Smc2','Foxl1','Fmr1','Fstl1','Fzd8','G0s2','G6pc','Gas1','Gata2','Gcm1','Gcnt2','Gdf5','Glycam1','Gna14','Gpc4','Grid1','Grik5','Grm8','Gstm2','Has1','Has2','Foxq1','Foxd1','Ppap2a','Foxa1','Hoxa13','Hoxa4','Hoxd8','Hpd','Hpgd','Hrsp12','Hsd11b2','Sdc2','Hus1','Idh3g','Lrig1','Inhbb','Irx3','Itga7','Itgae','Kcnj9','Kcnq1','Kif4','Kif5c','Serpina3c','Krt19','Krt4','Lag3','Lamb1','Lamb2','Lamb3','Lamc2','Ldhb','Lep','Lhx5','Xcl1','Lrp5','Ltc4s','Ltk','Masp1','Mcm4','Mcm6','Foxc1','Mgmt','Cxcl9','Mme','Mmp2','Me1','Mdh1','Gbp4','Mrc2','Mybl2','Myf5','Ngp','Nid2','Nkx2-3','Nqo1','Nos3','Npdc1','Ntsr2','Nxn','Orm1','Cldn11','Pafah1b2','Pcolce','Pcsk4','Pemt','Pfkfb1','Phka1','Phxr4','Phox2b','Pold2','Ppargc1a','Ppic','Prkg2','Ptch1','Ptch2','Ptdss1','Ptgfr','Ptgis','Ptgs1','Ptn','Ptpn14','Ptprk','Ptprn','Ptrf','Pxmp2','Rab4a','Rfng','Rfx2','Rag1ap1','Rpl18','Polr1d','Rps4x','Prrx2','Ccl22','Cxcl5','Sema3a','Sema5a','Sftpd','St6galnac2','Six1','Clpb','Slc12a2','Slc2a4','Snn','Sox11','Sox4','Sparc','Serpina3n','Spnb2','Stc1','Tarbp2','Tbx15','Acat2','Inmt','Tfdp1','Tgfb1i1','Tgfb2','Tgfbi','Thrsp','Thy1','Tk1','Tuba3b','Unc5c','Vmn2r89','Vdr','Vegfc','Wnt4','Wnt5a','Wnt6','Xrcc5','Zfp101','Zfp37','Zfp51','Zfp93','Zfp94','Zic4','Zik1','Accn2','Actg2','Adamts1','Angpt1','Ank3','Aoc3','Aox1','Ap3s1','Apbb1','Nr2f2','Aqp5','Atp4b','Atp5f1','Bmpr1a','Bnip3','Klf5','C3','C4b','Cask','Casp3','Ccnd2','Cd68','Cdh11','Ift81','Ch25h','Cish','Cldn4','Ccr4','Col3a1','Col4a1','Col4a2','Col6a1','Cox6a2','Cox7a1','Igf2bp1','Csnk2a2','Ctsd','Cyp1b1','Cyp2j6','Cyp46a1','Dag1','Dbt','Des','Dmwd','Ebf2','Sparcl1','S1pr3','Efnb1','Ehd1','En1','Ephb2','Ephx1','Epn2','Nr2f1','Khdrbs3','Eya1','Eya4','F2r','Fadd','Fah','Fbln1','Fgf11','Fgfr2','Fhl4','Figf','Fkbp4','Fkbp7','Foxf2','Foxs1','Fmo1','Fosl1','Aktip','Gdap2','Gpd1','Gdf11','Gdi1','Gdnf','Gja1','Gnb5','Gng3','Gpaa1','Ednra','Nmur1','H2-Q10','Hira','Hoxa3','Hoxa5','Hoxa6','Hoxc6','Hoxd3','Hs3st1','Hsd17b7','Id1','Ifit3','Cyr61','Igfbp4','Irs3','Irx1','Krt18','Lama4','Lbx1','Lect2','Lef1','Maff','Mbd4','Meox1','Mog','Mpdz','Ncl','Ndn','Nedd4','Nek2','Nfe2l3','Nid1','Nnat','Nnmt','Oc90','Osmr','Otx1','Pabpc2','Pck1','Pcna','Pde3b','Per2','Pex11a','Pfdn2','Phkg1','Piga','Prkca','Pold1','Prnp','Ptpn13','Ptpn3','Pitpnm2','Rorc','Rpa2','Polr2j','Uimc1','Cxcl15','Serf1','Six4','Six5','Slit3','Smarca2','Snai1','Snap25','Sncg','Sod3','Sox9','Spin1','Spink4','Sprr2k','Tbx1','Tff3','Tgfbr3','Thbs2','Ppp1r13b','Trpc1','Tsn','Tubb5','Tulp3','Twist1','Vmn2r88','Wnt8b','Siae','Zan','Zfp54','Zfp9','Zfpm2','Slc30a4','Adamts5','Aplnr','Aloxe3','Grem2','Nt5e','Odz4','Osr1','Med24','Sgcd','Spry1','Spry4','Abcg2','Aldh1a7','Angptl2','Clcn6','Decr2','Sema4g','Vnn3','Zfp146','Homer1','Slc27a3','Dpysl4','Aifm1','Racgap1','Rgnef','Pla2g2e','Asns','Fkbp9','Atp1b2','Cfd','Adra1d','Adrb3','Anxa8','Apoa2','Btk','Clu','Epb4.9','Foxc2','Hoxd9','Hprt','Ifrd1','Kcnh2','Lrpap1','Mc5r','Kitl','Mx2','Sypl','Psmb10','Ptger1','Sema3c','Sema5b','Surf1','Zfp30','Cops5','Plek2','Pdk4','Zfp354b','Phlda3','Insl6','Tbl2','Hsd17b6','Epb4.1l3','Plcb4','Uxt','Ror1','Abca8b','Pmm1','Dnajc12','Fkbp3','Fbxw5','Ddx25','Col5a1','Galr3','Gbx1','Fbxo17','Fbxo15','Crim1','Krtap5-1','Dmrt1','Galt','Stra13','Sntb1','Comp','Sfrp4','Aqp3','Hmgn5','Atp5j','Matn2','Prdx4','Dmp1','Usp2','Ppp1r3c','Fkbp1b','Stk39','Wisp2','Deaf1','Cks1b','Porcn','Nckap1','Phgdh','Mtmr1','Acadvl','Gabre','Hp','Nfil3','Ostf1','Tef','rp9','Rai12','Sema6a','Pgcp','St3gal6','Zfp108','Eef1b2','Hs3st3b1','Irx5','Akr1e1','Slc1a4','Cpxm2','Pdzrn3','Rnf5','Cetn2','Pfn2','Ndufb11','Rfk','Hgfac','Usp27x','Pqbp1','Ppie','Mad2l1','Fxc1','Fxyd1','Dgke','Car5b','Lgals12','Rbm38','Abcb10','Patz1','Cacna1f','Rrad','Fads2','Smc1a','Dpt','Amotl2','Vps29','Maged1','Pde4a','Gkap1','Fam69b','Ltbp1','Zfp111','Sort1','Mos','B3galnt1','Lpar2','Poll','Trim44','Pdxp','Tnfrsf10b','Cldn9','Ank','Fzd2','Slc16a8','Slurp1','Plin4','Xrcc2','Terf2ip','Tbl1x','Parva','Slc46a2','Il4','Evc','Abhd1','Zfp112','Usp29','Cdon','Chml','Cryba4','Pappa','Slc43a3','Ush2a','Pard6b','Nap1l5','Taf1c','Cdc42ep5','Mlxipl','Ces1','Prps1','Treh','Kcnk5','Pcbp3','Ncstn','Ccbp2','Wbp11','Cldn15','Donson','Fads3','Npvf','Fxyd7','Flii','Gtf2h2','Map3k11','Tcte2','Slc28a3','Ptges','Abhd8','Ddr2','Lpin3','Zfand6','Xpo7','Clstn1','Pkmyt1','Aspa','Rce1','Ubd','Nono','Ranbp17','Cwc15','Znrd1','Mtvr2','Klf15','Sbds','Rhoj','Mrpl46','Snap29','Npc2','Mum1','Elac2','1110032A03Rik','Pla2g12b','Wdr31','Sars2','Ssbp3','Tbx18','Paqr4','Cxx1a','Gpx7','Jkamp','Gpn3','Mrpl28','Gins4','Mxra8','Osbpl5','Tnfrsf23','Stx1b','Derl3','Scd3','Lyar','Cpa1','Sarnp','Acy1','Eef1e1','Atp6v1f','Tmem57','Fbxo36','Pycrl','Eif1ax','1810029B16Rik','2810021B07Rik','Mrps22','1700020L24Rik','Cdrt4','1700029P11Rik','Anapc16','Nudt8','Commd5','Mcts2','1810049H13Rik','Magohb','Spc25','Tnfaip8l1','Ctrb1','Rpl15','Cul7','Rep15','Bpil1','Col27a1','Dcbld1','Tmem186','Hrasls5','Ttc35','Erlec1','Tmem170','Bcs1l','Rsrc1','Appbp2','Fank1','1700010I14Rik','Dsn1','Acad8','Trim59','Med19','Smarcd3','Mettl6','Ift27','Higd2a','Rps6ka6','Zbtb8os','Dynlt3','Nradd','Zcrb1','Lass4','Hmgn3','Mrpl10','Retsat','Abhd15','Ankzf1','Calcoco1','1700019N19Rik','Uqcrb','Fibin','Mxra7','4930511I11Rik','4930522H14Rik','Spaca1','Rnf125','Tmem179b','1810048J11Rik','Nudt13','Mansc1','5033414D02Rik','Brix1','1700021F05Rik','S100a16','Mrrf','Mri1','Ppm1m','Wdr55','Tctn2','Mrpl19','Nudt12','Fam134c','Atp5s','Chd1l','3010026O09Rik','Fam92a','Upf3b','Ebpl','Fam135a','Ndufa5','Ggct','2410017P07Rik','Toe1','Tlcd1','Ccdc163','Echdc2','9530077C05Rik','Mrpl13','1110012L19Rik','Smyd2','Hddc3','Rabl2','Cilp2','D4Bwg0951e','Lrrc16a','Taf11','Gkn3','Rasl11a','Rasl11b','1500011H22Rik','Cab39l','Lyzl4','Zdhhc3','1810014F10Rik','1810011O10Rik','Snrpd2','Lzic','Dtwd1','Ddah1','1700007K13Rik','Gcap14','Slc38a4','1700013G24Rik','Mrpl30','Avpi1','Gpx8','Ddx51','Ccdc115','Cdc42ep1','Cobll1','Eif1ad','2010003K11Rik','Ints4','Ptcd3','Sdr9c7','2210010C17Rik','Lrrc39','Ppil3','Afap1','Hdac8','Isl2','Steap1','Aldh1l1','Lrrc28','2610034B18Rik','2610109H07Rik','Ddo','Lca5','Glipr2','Gulp1','6330406I15Rik','Dclk2','Prdm5','4931408A02Rik','4931417G12Rik','Spef1','Phf6','Spats1','Zbtb46','Oxsm','4933421I07Rik','Fam83c','5430416O09Rik','Cyp2u1','Fam110c','Mettl7b','Acy3','Lrwd1','Cpn2','Shroom1','1300017J02Rik','Ints12','Caskin1','Mlf1ip','Jsrp1','Xrcc4','Rbpms2','Cnn3','Ddx42','Ddb2','Pgm2','Nsun4','Lsm11','Xpo5','Brap','Ttc30b','Dzip1l','Naalad2','Hspa12b','Ccdc12','Angptl1','2410018L13Rik','Pot1b','Mblac2','Cxx1c','Pfn4','Asphd2','Prkcdbp','1700037C18Rik','1700040L02Rik','Rhobtb3','Dcbld2','1700065D16Rik','1700049G17Rik','1700057K13Rik','Zfp763','1700106N22Rik','Haus7','Efha1','Slc25a27','Rftn2','Phf19','Traf3ip1','Nphp3','Pacsin3','Cbx6','1200009I06Rik','Armc1','Tbc1d21','Xrcc3','Lrrtm1','Ttc25','Ppapdc2','Tktl2','4930452B06Rik','8430419L09Rik','Glb1l','Spsb1','4930444A02Rik','Lrrc48','Phpt1','Pibf1','Rsph9','Dusp9','1700011F14Rik','Speer4a','Rab4b','Slc10a6','Nln','Tmem49','6530401D17Rik','Tsen54','Prss23','Gatc','Dapk1','Dapl1','Mospd2','Mett5d1','Mnd1','2310014L17Rik','2900062L11Rik','Bcl7a','Gpbp1l1','Tbcd','Zfp142','Nkrf','Fam115a','Chst15','Prelid2','Apex2','Mmab','9230104L09Rik','Dcst1','Fam159b','Mlana','Grifin','Mccc2','Fam55b','Zfp449','Spata2L','Ttc30a1','Tspyl4','Polr3h','Rabep2','Hist1h1a','Maged2','Niacr1','Cpn1','Hspb8','Zfhx4','Kcnip2','Gpr84','Syt13','Mrgprh','Gpr63','Sil1','Id4','Il6','Krt8','Dscam','Tnxb','Klb','Akap12','Plekha3','Tex13','Sytl3','Trps1','Sucnr1','Rnf123','Cdo1','Ocm','Snurf','Lztfl1','Zfp423','Ly6g6d','Spred2','Cecr6','Wbscr16','Pcdhgc3','Pcdhgc4','Pcdhgc5','Pcdhga6','Amn','Mlph','Aldh1a3','Tspan4','Tcf23','15-Sep','Lmod1','Wnt16','Pcdhb14','Pcdhb16','Allc','Mrpl43','Mepe','Col4a6','Slc24a3','Sfxn4','Ces3','Magee1','Vmn1r53','Vmn1r40','Kiss1r','Dhcr24','Antxr1','Gpr124','Rcor2','Osr2','Pawr','Prelp','Pnpla3','Grhpr','Celsr3','Asb10','Eri3','Aco2','Nme5','Timp4','Vps4a','Pcdh18','Recql5','Sp7','Cdk9','Cdhr1','Eps8l2','Cstf2','Trhr2','Nup155','Apcdd1','Mapre3','Es22','Fbxl15','Pycr2','Klk10','Arhgap27','Metrn','Atp6v0e2','Adck4','Icmt','R74862','Tmem132a','Dst','Olfml3','Krba1','Chchd4','Dhx32','Arhgef18','Enpp3','Rdh5','Farp1','Kdelr3','Pppde2','Kcne2','Gpsm3','Fbxo38','Psmg2','Macrod1','Il17rc','Il17rd','Gpr37l1','Cd99l2','H1foo','Ubfd1','Sardh','Sdpr','Nap1l3','Ppp2r4','Cspg4','Dnajc17','Spats2','Zfp192','Slc6a20a','Satb2','Rab40b','Pla2g16','Wnt9a','Gatad2b','Acer2','Slc6a13','Tbc1d19','Snap47','Zfp119','Myrip','Bivm','Acat1','Chrna2','Camk1g','Ncaph','Cbara1','Ube2e2','Eppk1','Cyyr1','Lims2','Ndufs8','Cox15','Plekha5','BC018242','2610305D13Rik','Ugt1a6a','Gtpbp6','Oas1f','Diras1','Alms1','Akr1d1','Eif2b1','Mios','Mrgprf','Rho','Tapbpl','Bag2','Duoxa1','Fam173a','Llgl2','Ubxn2a','A2ld1','Farp2','Trub2','Atg13','Tm4sf4','Zfp189','Efcab7','Fbxo21','Gys2','Cald1','Mypop','Pgap2','Fgl1','Tmem184c','Kank2','Pdk3','Adig','Tinf2','Obox2','Odf4','Zfp7','Cenpi','Cth','Cc2d1a','Col6a2','Ankmy2','Gmds','Fermt2','Prr5','Krt79','Apbb3','Zadh2','Habp2','Lyplal1','Zfp282','Kctd15','Slc1a7','Slc29a4','Zfp668','Olfr291','Slc1a3','Otud6b','Las1l','Ehd2','Zfp353','Kif1c','Gtpbp10','Mmrn2','Abca8a','Slc36a2','Hist1h4h','Col23a1','Gpr156','Rbm45','Rnf113a1','Pilra','Kcng3','Lrrc41','Nrn1','Tenc1','C85492','Aldh1l2','Mboat1','Yrdc','Fam13a','Cxcl17','Nipa1','Cmtm4','Lgsn','Cpt1c','Atoh8','Mylip','Scarf2','Rell2','Polr2b','Pkn3','Cpne1','Disp2','U2af1l4','Rpl32','Kdm4b','Zdhhc8','Dync2li1','Kdm1b','Eif2b5','Phyhd1','Cc2d2a','Snapc4','BC026439','Zfp759','9130011J15Rik','Slc25a32','Ccbl1','Rap2c','Mobkl2a','Sned1','Zc3hav1l','Mtrr','Nhlrc3','Boc','Nut','Arhgap29','A130042E20Rik','Tada2a','Tns4','Mettl2','Fbf1','Coq6','Scara3','Vps52','Lgr4','Acad9','Foxj3','9330182L06Rik','AA881470','Leng8','Hirip3','L3mbtl3','Zfp454','Rspo2','Ttll8','Peli3','9430031J16Rik','Olfml2a','Zfp697','Zfp462','Palm2','Bnc2','Tmprss11e','Slc13a4','Abcc12','Heg1','Ankrd13b','Pank4','Tspan12','A430110N23Rik','Serpina3b','Adcy10','Eif5','Chd6','Xkr6','Bmp3','Fam110b','4921523A10Rik','Arsj','2310044G17Rik','Galntl4','Maoa','2610019F03Rik','Cenpe','Fam69c','Olfm2','Npr2','Gm5077','Pgm5','Aqp6','Trib3','Prickle3','Tmem177','Ankrd46','Chst8','2300002M23Rik','2310022B05Rik','2610204G22Rik','Ptk7','Gpr22','Golim4','Hspa12a','Snip1','Zfp28','Arid2','Shisa4','Lpar4','Srd5a1','Tprn','Slc6a15','2700081O15Rik','Fam73b','Fam163b','Zfp526','Clvs2','Glis3','Nmnat2','Zfp770','Gpr61','Adamts12','D730040F13Rik','Gpr81','Arhgap20','Wnk4','Adamts2','Dmrta1','Hist1h2af','Hist2h2bb','Ankrd5','4931440F15Rik','1110036O03Rik','Fbxo2','Lrtm1','Itga11','6430573F11Rik','Atp10b','E030011O05Rik','Apba1','A530016L24Rik','Tmem198','Olfml2b','Sp8','3-Mar','Glt28d2','Lrig3','Dennd5b','Atp8b5','Ocrl','L3mbtl4','Itgb8','Hmbox1','Agphd1','Ofd1','Clec16a','Vps37d','Plekhh2','Lim2','4833427G06Rik','Tusc5','1600021P15Rik','Lrrc8a','Rgma','9030224M15Rik','Gm11961','Gm5084','Tnn','4933431E20Rik','C130026L21Rik','Hapln4','4933402J07Rik','Opcml','Gmpr2','Dixdc1','Prkaa2','Pik3ip1','Hist1h2ai','Smg5','Arhgap33','Cidec','Commd10','Cox10','Dhx38','Car12','Pus7','Atp1a2','Zfp334','Ccdc144b','Ints7','4933409K07Rik','Creb3l2','8030462N17Rik','Cep120','Eno4','Clca5','Dpy19l3','Rnf214','Rxfp3','Zpld1','D630039A03Rik','A730069N07Rik','Spin4','Agbl2','Irf2bp1','Ppip5k1','Garnl3','Mal2','Ostb','Txlng','Col14a1','C1rl','Mustn1','Pxdn','Pik3c3','Pkd2l1','Cmbl','Art3','Gpr120','R3hdm1','Wfikkn2','Cd59b','Zfp184','Nfkbil2','Ttc29','Ttc17','4930474M22Rik','1700029I15Rik','Cyp2ab1','Gprin3','Nkx6-2','Ccdc72','Rnmtl1','Nxph4','Mpa2l','Akap9','Trim68','Setx','Exoc8','Lrrc24','Abi2','Pip5kl1','Tanc1','Helz','Ckmt2','Bahcc1','Eid2','Gxylt2','Mtss1l','Slc22a20','Iars2','Odf3l1','Zbtb12','Enpp4','Chst9','BC051665','Bckdhb','Rtn4rl2','Tmem39b','Ece1','Phkb','Zhx2','Dand5','Krt9','Flrt1','Pde4c','Eapa2','Cebpe','BC048355','Wtip','Ccdc87','Wrb','Zfp81','Dlk2','Dedd2','Snord35a','Snord15a','Npm3-ps1','Gas5','Gm1821','Serpina4-ps1','Peg13','Dnm3os','Has2as','Snord61','H2afy3','Gm6578','4933400A11Rik','Rnu73a','Chkb-Cpt1b','BC064078','D130017N08Rik','A930005H10Rik','2810403D21Rik','1700030C10Rik','9530026P05Rik','9630028H03Rik','1700009J07Rik','9530036O11Rik','A330023F24Rik','4732416N19Rik','4930488L21Rik','AI854703','A230020J21Rik','Pdxk-ps','D6Ertd474e','5031426D15Rik','Snhg9','Msx1as','2010204K13Rik','4930507D05Rik','4632415L05Rik','4930433N12Rik','2310068J16Rik','Gm6644','Tmem181d-ps','B230319C09Rik','Scarna10','Snord57','Snord88c','Snord45b','Snord1a','5330413P13Rik','1700018A04Rik','2810454H06Rik','4930579K19Rik','5033406O09Rik','Mir99a','Mir99b','Mir130a','Mir144','Mir145','Mir152','Mir10b','Mir129-1','Mir181a-2','Mir182','Mir184','Mir191','Mir194-1','Mir205','Mir122a','Mir143','Mirlet7b','Mir26a-1','Mir29a','Mir31','Mir148b','Mir338','Mir344','Mir345','Mir101b','Mir1-2','Mir100','Mir139','Mir210','Mir214','Mir320','Mir222','Mir199a-2','Mir199b','Mir92-1','Mir335','Mir483','Mir503','Mir684-2','Mir701','Mir708','Mir709','Mir717','Mir92b','Mir582','A630072M18Rik','D430050G20','Mir183','4933427E11Rik','BC020402','BC039771','D330050I16Rik','4930429F11Rik','2610100L16Rik','Gm9961','Gm10516','Gm14812','1700048O20Rik','E130304I02Rik','4930503H13Rik','AA474331','4921531C22Rik','Snora5c','Snora81','Mir1192','Mir1894','Mir1901','Mir1934','Mir1940','Mir1943','Mir1306','Mir1964','Mir1968','Mir1971','Mir664','Trim43c','AI506816','Gm10818','Trim43b','Haus5','Setmar','Kif6','1300010F03Rik','Zfp507','Rbm20','Prr12','Anks1b','Gm8898','Syde2','Ndufa4l2','Gm10324','1700108F19Rik','Cdsn','AI429214','Nanog','Eno3','Tgoln1','Oas1b','Homez','Gm1987','B430212C06Rik','Gm10649','Ndor1','Lmo7','Gm13476','Scn2a1','Zfp618','Ranbp3l','1700049E15Rik','Cldn24','Pcdh19','Emx2os','Morf4l2','Lhb','Tfdp2','Trib2','Pnma3','5830418K08Rik','2610029I01Rik','Kbtbd11','6720401G13Rik','1110021L09Rik','Mageb16','Wdr25','2700029M09Rik','2210015D19Rik','Nat8l','Hfm1','Dynlt1c','Klhl22','Rarres1','Grm2','BC005561','Epb4.1l4b','Dennd4a','Nynrin','Ttc28','BC006965','2610028E06Rik','2810410L24Rik','AI464131','Gm10451','4632428C04Rik','Ccdc8','Aff3','Tbx3','Gm3448','A930012L18Rik','Npas3','Gm11468','Nhsl2','2210403K04Rik','Fam129c','Gm6924','Gm13305','Klhdc8b','Gm88','Gm10136','Prdm11','Zyg11a','Ccdc154','Ctla4','4933432B09Rik','9130023H24Rik','Ccdc37','Srbd1','Rab11fip3','Synpo','9630013A20Rik','Gm10584','Zbtb11','Fam57b','Fam196a','Vmn1r109','Ncrna00081','4933406J08Rik','Myt1l','Zfp420','Apol6','2610005L07Rik','Ddx10','Vmn1r157','Pfas','Cisd3','Taf4b','Aldh3b2','Efhc1','Gm4850','Slco6d1','Mocs3','1700029J11Rik','Izumo3','Cib4','4930588N13Rik','Ccdc89','4933405L10Rik','1810046K07Rik','Kbtbd13','Gm4984','Myom3','Arhgap42','1700061J05Rik','6430550D23Rik','Mast4','Thsd7a','Zfp229','Fam189a2','Pcsk6','Zfp558','Gm1332','Syde1','1700056E22Rik','Gm13251','2310043J07Rik','Nkx6-3','Mef2b','Otud6a','D6Ertd527e','Lass3','Vmn1r39','D830031N03Rik','Apoo-ps','Igsf10','Gm5415','Zfp862','Clrn2','Fam178b','Mllt4','4933436C20Rik','Vmn1r31','Gm13124','Gm6880','Gm6654','1500009L16Rik','Cdkn3','4930511M06Rik','LOC664987','Gm12824','Lrrc17','2900002K06Rik','Vmn2r18','Esm1','Rfpl4b','Dlg5','Rbm15b','0610012G03Rik','Clec2l','2610015P09Rik','Cpm','LOC624853','D630045J12Rik','Cdc42bpa','1700109F18Rik','Gm8615']
    analyzer = EnrichedOntologiesAnalyzer()
    analyzer.output_go_enriched_ontology('/Users/karmel/Desktop/Projects/GlassLab/SourceData/ThioMac_Lazar/analysis/Adipocyte_comparisons/h3k9ace', 
                                         'adipocyte_only', 'mm9', gene_names)
    analyzer.graph_terms('/Users/karmel/Desktop/Projects/GlassLab/SourceData/ThioMac_Lazar/analysis/Adipocyte_comparisons/h3k9ace', 
                                         'adipocyte_only', 'mm9', gene_names)